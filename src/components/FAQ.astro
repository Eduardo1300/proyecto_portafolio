---
import { i18n, defaultLanguage } from '../config/i18n';

interface FAQItem {
  question: string;
  answer: string;
}

const lang = defaultLanguage;
const texts = i18n[lang];

const faqs: FAQItem[] = texts.faq.items;
---

<section id="faq" class="py-16 md:py-24 lg:py-32 bg-slate-950" data-i18n="faq">
  <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="max-w-3xl mx-auto">
      {/* Section header */}
      <div class="text-center mb-12 md:mb-16">
        <span class="text-cyan-500 text-xs sm:text-sm font-medium tracking-wider uppercase mb-3 md:mb-4 block faq-label">
          {texts.faq.label}
        </span>
        <h2 class="text-2xl sm:text-3xl md:text-4xl lg:text-5xl font-bold tracking-tight mb-4 md:mb-6 faq-title">
          {texts.faq.title}
        </h2>
        <p class="text-slate-400 text-base sm:text-lg px-2 faq-description">
          {texts.faq.description}
        </p>
      </div>

      {/* Accordion */}
      <div class="space-y-3 md:space-y-4" role="region" aria-label="Preguntas frecuentes">
        {
          faqs.map((faq, index) => (
            <details 
              class="group border border-slate-800 rounded-xl px-4 md:px-6 bg-slate-900/50 hover:border-cyan-500/50 transition-colors focus-within:ring-2 focus-within:ring-cyan-500"
              id={`faq-${index}`}
            >
              <summary 
                class="text-left cursor-pointer py-4 md:py-6 font-medium text-white flex items-center justify-between text-sm md:text-base focus:outline-none hover:text-cyan-400 transition-colors select-none faq-question"
                aria-expanded="false"
                aria-controls={`faq-answer-${index}`}
              >
                <span class="pr-3 md:pr-4 text-left">{faq.question}</span>
                <span 
                  aria-hidden="true"
                  class="text-slate-400 group-open:text-cyan-400 group-open:rotate-180 transition-all flex-shrink-0"
                >
                  â–¼
                </span>
              </summary>
              <div 
                id={`faq-answer-${index}`}
                class="text-slate-400 pb-4 md:pb-6 leading-relaxed border-t border-slate-800 pt-4 md:pt-6 text-sm md:text-base animate-fade-in faq-answer"
                role="region"
              >
                {faq.answer}
              </div>
            </details>
          ))
        }
      </div>
    </div>
  </div>
</section>

{/* JSON-LD Schema para FAQ */}
<script type="application/ld+json" set:html={JSON.stringify({
  "@context": "https://schema.org",
  "@type": "FAQPage",
  "mainEntity": faqs.map(faq => ({
    "@type": "Question",
    "name": faq.question,
    "acceptedAnswer": {
      "@type": "Answer",
      "text": faq.answer
    }
  }))
})} />

<script>
  import { i18n } from '../config/i18n';
  
  function updateFAQTexts() {
    const lang = (document.documentElement.dataset.lang as keyof typeof i18n) || 'es';
    const texts = i18n[lang];
    
    // Update label
    const labelEl = document.querySelector('.faq-label');
    if (labelEl) labelEl.textContent = texts.faq.label;
    
    // Update title
    const titleEl = document.querySelector('.faq-title');
    if (titleEl) titleEl.textContent = texts.faq.title;
    
    // Update description
    const descEl = document.querySelector('.faq-description');
    if (descEl) descEl.textContent = texts.faq.description;
    
    // Update FAQ items
    const questionElements = document.querySelectorAll('.faq-question');
    const answerElements = document.querySelectorAll('.faq-answer');
    
    texts.faq.items.forEach((item, index) => {
      if (questionElements[index]) {
        const span = questionElements[index].querySelector('span');
        if (span) span.textContent = item.question;
      }
      if (answerElements[index]) {
        answerElements[index].textContent = item.answer;
      }
    });
  }
  
  // Update on language change
  document.addEventListener('languageChanged', updateFAQTexts);
  
  // Initial update
  updateFAQTexts();
</script>
