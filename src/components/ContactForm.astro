---
import { i18n, defaultLanguage } from '../config/i18n';

const lang = defaultLanguage;
const texts = i18n[lang];

const formTexts = {
  es: {
    name: "Tu nombre",
    email: "Tu correo electrónico",
    subject: "Asunto",
    message: "Tu mensaje",
    send: "Enviar mensaje",
    sending: "Enviando...",
    success: "¡Mensaje enviado correctamente!",
    error: "Error al enviar el mensaje. Intenta de nuevo."
  },
  en: {
    name: "Your name",
    email: "Your email",
    subject: "Subject",
    message: "Your message",
    send: "Send message",
    sending: "Sending...",
    success: "Message sent successfully!",
    error: "Error sending message. Please try again."
  }
};

const currentTexts = formTexts[lang as keyof typeof formTexts] || formTexts.es;
---

<form 
  action="https://formspree.io/f/mjgwedza" 
  method="POST"
  class="contact-form max-w-2xl mx-auto space-y-6"
  id="contactForm"
>
  {/* Name field */}
  <div>
    <label for="name" class="block text-sm font-medium text-foreground mb-2">
      <span class="name-label">{currentTexts.name}</span>
    </label>
    <input
      type="text"
      id="name"
      name="name"
      required
      class="w-full px-4 py-3 rounded-lg bg-secondary/50 border border-border text-foreground placeholder-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-all"
      placeholder={currentTexts.name}
      aria-label={currentTexts.name}
    />
  </div>

  {/* Email field */}
  <div>
    <label for="email" class="block text-sm font-medium text-foreground mb-2">
      <span class="email-label">{currentTexts.email}</span>
    </label>
    <input
      type="email"
      id="email"
      name="email"
      required
      class="w-full px-4 py-3 rounded-lg bg-secondary/50 border border-border text-foreground placeholder-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-all"
      placeholder={currentTexts.email}
      aria-label={currentTexts.email}
    />
  </div>

  {/* Subject field */}
  <div>
    <label for="subject" class="block text-sm font-medium text-foreground mb-2">
      <span class="subject-label">{currentTexts.subject}</span>
    </label>
    <input
      type="text"
      id="subject"
      name="subject"
      required
      class="w-full px-4 py-3 rounded-lg bg-secondary/50 border border-border text-foreground placeholder-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-all"
      placeholder={currentTexts.subject}
      aria-label={currentTexts.subject}
    />
  </div>

  {/* Message field */}
  <div>
    <label for="message" class="block text-sm font-medium text-foreground mb-2">
      <span class="message-label">{currentTexts.message}</span>
    </label>
    <textarea
      id="message"
      name="message"
      rows={6}
      required
      class="w-full px-4 py-3 rounded-lg bg-secondary/50 border border-border text-foreground placeholder-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-all resize-none"
      placeholder={currentTexts.message}
      aria-label={currentTexts.message}
    ></textarea>
  </div>

  {/* Submit button */}
  <div class="pt-4">
    <button
      type="submit"
      class="w-full px-6 py-3 rounded-lg bg-primary text-primary-foreground font-semibold hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 focus:ring-offset-background transition-all duration-300 hover:scale-105 active:scale-95 form-submit-btn glow"
      aria-label={currentTexts.send}
    >
      <span class="submit-text">{currentTexts.send}</span>
    </button>
  </div>

  {/* Status message */}
  <div 
    id="formStatus" 
    class="hidden mt-4 p-4 rounded-lg text-center text-sm font-medium"
    role="alert"
  >
    <span class="status-message"></span>
  </div>
</form>

<script>
  const formTexts = {
    es: {
      name: "Tu nombre",
      email: "Tu correo electrónico",
      subject: "Asunto",
      message: "Tu mensaje",
      send: "Enviar mensaje",
      sending: "Enviando...",
      success: "¡Mensaje enviado correctamente!",
      error: "Error al enviar el mensaje. Intenta de nuevo."
    },
    en: {
      name: "Your name",
      email: "Your email",
      subject: "Subject",
      message: "Your message",
      send: "Send message",
      sending: "Sending...",
      success: "Message sent successfully!",
      error: "Error sending message. Please try again."
    }
  };

  const form = document.querySelector('.contact-form') as HTMLFormElement;
  const statusDiv = document.querySelector('#formStatus') as HTMLDivElement;
  const submitBtn = form?.querySelector('.form-submit-btn') as HTMLButtonElement;
  const statusMessage = statusDiv?.querySelector('.status-message') as HTMLSpanElement;

  function getCurrentTexts() {
    const lang = localStorage.getItem('language') || 'es';
    return formTexts[lang as keyof typeof formTexts] || formTexts.es;
  }

  function updateFormLabels() {
    const lang = localStorage.getItem('language') || 'es';
    const isES = lang === 'es';
    
    const labels = {
      name: isES ? "Tu nombre" : "Your name",
      email: isES ? "Tu correo electrónico" : "Your email",
      subject: isES ? "Asunto" : "Subject",
      message: isES ? "Tu mensaje" : "Your message",
      send: isES ? "Enviar mensaje" : "Send message"
    };

    document.querySelector('.name-label')!.textContent = labels.name;
    document.querySelector('.email-label')!.textContent = labels.email;
    document.querySelector('.subject-label')!.textContent = labels.subject;
    document.querySelector('.message-label')!.textContent = labels.message;
    document.querySelector('.submit-text')!.textContent = labels.send;
    
    // Update placeholders
    (document.querySelector('#name') as HTMLInputElement).placeholder = labels.name;
    (document.querySelector('#email') as HTMLInputElement).placeholder = labels.email;
    (document.querySelector('#subject') as HTMLInputElement).placeholder = labels.subject;
    (document.querySelector('#message') as HTMLTextAreaElement).placeholder = labels.message;
  }

  if (form) {
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const texts = getCurrentTexts();
      submitBtn.disabled = true;
      submitBtn.textContent = texts.sending;

      try {
        const formData = new FormData(form);
        const response = await fetch(form.action, {
          method: 'POST',
          body: formData,
          headers: {
            'Accept': 'application/json'
          }
        });

        if (response.ok) {
          statusDiv.classList.remove('hidden', 'bg-red-500/20', 'text-red-200');
          statusDiv.classList.add('bg-green-500/20', 'text-green-200');
          statusMessage.textContent = texts.success;
          form.reset();
          setTimeout(() => {
            statusDiv.classList.add('hidden');
            submitBtn.disabled = false;
            submitBtn.textContent = getCurrentTexts().send || "Enviar mensaje";
          }, 3000);
        } else {
          throw new Error('Form submission failed');
        }
      } catch (error) {
        statusDiv.classList.remove('hidden', 'bg-green-500/20', 'text-green-200');
        statusDiv.classList.add('bg-red-500/20', 'text-red-200');
        statusMessage.textContent = texts.error;
        submitBtn.disabled = false;
        submitBtn.textContent = getCurrentTexts().send || "Enviar mensaje";
      }
    });

    // Actualizar labels cuando cambio de idioma
    document.addEventListener('languageChanged', updateFormLabels);
  }
</script>

<style>
  @media (prefers-reduced-motion: reduce) {
    button {
      transition: none !important;
    }
  }
</style>
