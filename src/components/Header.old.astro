---
import { i18n, defaultLanguage } from '../config/i18n';

const lang = defaultLanguage;
const texts = i18n[lang];
---

<header class="fixed top-0 left-0 right-0 z-50 border-b border-slate-800/30 bg-slate-950/90 backdrop-blur-md" role="banner">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 md:px-8 lg:px-12 h-16 md:h-20 flex items-center justify-between">
    {/* Logo */}
    <a href="/" class="text-lg md:text-2xl font-bold text-white whitespace-nowrap focus:outline-none focus:ring-2 focus:ring-cyan-500 rounded px-2" aria-label="Dev Studio - Inicio">
      dev<span class="text-cyan-400 font-bold">:studio</span>
    </a>

    {/* Navigation */}
    <nav class="hidden md:flex items-center gap-8 lg:gap-12" aria-label="Navegación principal">
      <a href="#servicios" class="text-sm text-slate-400 hover:text-white transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-cyan-500 rounded px-2 py-1 nav-servicios" aria-current="false">
        {texts.nav.servicios}
      </a>
      <a href="#proceso" class="text-sm text-slate-400 hover:text-white transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-cyan-500 rounded px-2 py-1 nav-proceso">
        {texts.nav.proceso}
      </a>
      <a href="#beneficios" class="text-sm text-slate-400 hover:text-white transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-cyan-500 rounded px-2 py-1 nav-beneficios">
        {texts.nav.beneficios}
      </a>
      <a href="#faq" class="text-sm text-slate-400 hover:text-white transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-cyan-500 rounded px-2 py-1 nav-faq">
        {texts.nav.faq}
      </a>
      <a
        href="#contacto"
        class="cta-primary glow px-6 py-2.5 text-sm font-medium focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-slate-950 focus:ring-cyan-500 rounded transition-all hover:shadow-lg hover:shadow-cyan-500/20 nav-contacto"
      >
        {texts.nav.contacto}
      </a>

      {/* Language Switcher */}
      <div class="flex items-center gap-3 ml-6 pl-6 border-l border-slate-700" aria-label="Selector de idioma">
        <button 
          id="lang-es"
          class="lang-btn px-3 py-1.5 rounded text-sm font-medium transition-all focus:outline-none focus:ring-2 focus:ring-cyan-500 bg-cyan-500 text-slate-950 hover:bg-cyan-400"
          aria-label="Cambiar a español"
          aria-current="true"
        >
          ES
        </button>
        <button 
          id="lang-en"
          class="lang-btn px-3 py-1.5 rounded text-sm font-medium transition-all focus:outline-none focus:ring-2 focus:ring-cyan-500 bg-slate-800/50 text-slate-400 hover:text-white border border-slate-700 hover:border-slate-600"
          aria-label="Cambiar a inglés"
          aria-current="false"
        >
          EN
        </button>
      </div>
    </nav>

    {/* Mobile menu button */}
    <button 
      class="md:hidden text-white text-xl p-2 focus:outline-none focus:ring-2 focus:ring-cyan-500 rounded" 
      id="mobile-menu"
      aria-label="Abrir menú"
      aria-expanded="false"
      aria-controls="mobile-nav"
    >
      ☰
    </button>
  </div>

  {/* Mobile menu */}
  <nav
    id="mobile-nav"
    class="hidden md:hidden border-t border-slate-800 bg-slate-950"
    aria-label="Navegación móvil"
  >
    <div class="px-3 sm:px-4 py-3 space-y-2">
      <a
        href="#servicios"
        class="block text-sm text-slate-400 hover:text-white py-2 focus:outline-none focus:ring-2 focus:ring-cyan-500 rounded px-2 transition-colors nav-servicios-mobile"
      >
        {texts.nav.servicios}
      </a>
      <a
        href="#proceso"
        class="block text-sm text-slate-400 hover:text-white py-2 focus:outline-none focus:ring-2 focus:ring-cyan-500 rounded px-2 transition-colors nav-proceso-mobile"
      >
        {texts.nav.proceso}
      </a>
      <a
        href="#beneficios"
        class="block text-sm text-slate-400 hover:text-white py-2 focus:outline-none focus:ring-2 focus:ring-cyan-500 rounded px-2 transition-colors nav-beneficios-mobile"
      >
        {texts.nav.beneficios}
      </a>
      <a
        href="#faq"
        class="block text-sm text-slate-400 hover:text-white py-2 focus:outline-none focus:ring-2 focus:ring-cyan-500 rounded px-2 transition-colors nav-faq-mobile"
      >
        {texts.nav.faq}
      </a>
      <a
        href="#contacto"
        class="block cta-primary text-center py-2 mt-2 text-sm focus:outline-none focus:ring-2 focus:ring-cyan-500 rounded transition-colors nav-contacto-mobile"
      >
        {texts.nav.contacto}
      </a>

      {/* Language Switcher Mobile */}
      <div class="border-t border-slate-700 mt-3 pt-3">
        <p class="text-xs text-slate-500 mb-2 px-2 lang-label-mobile">{texts.footer.language}</p>
        <div class="flex items-center gap-2 px-2">
          <button 
            id="lang-es-mobile"
            class="lang-btn-mobile flex-1 px-2 py-1.5 rounded text-sm font-medium transition-all focus:outline-none focus:ring-2 focus:ring-cyan-500 bg-cyan-500 text-slate-950"
            aria-label="Cambiar a español"
            aria-current="true"
          >
            ES
          </button>
          <button 
            id="lang-en-mobile"
            class="lang-btn-mobile flex-1 px-2 py-1.5 rounded text-sm font-medium transition-all focus:outline-none focus:ring-2 focus:ring-cyan-500 bg-slate-900/50 text-slate-400 hover:text-white border border-slate-800"
            aria-label="Cambiar a inglés"
            aria-current="false"
          >
            EN
          </button>
        </div>
      </div>
    </div>
  </nav>
</header>

<script>
  const mobileMenuBtn = document.getElementById('mobile-menu');
  const mobileNav = document.getElementById('mobile-nav');

  if (mobileMenuBtn && mobileNav) {
    mobileMenuBtn.addEventListener('click', () => {
      const isOpen = !mobileNav.classList.contains('hidden');
      mobileNav.classList.toggle('hidden');
      mobileMenuBtn.setAttribute('aria-expanded', isOpen ? 'false' : 'true');
    });

    // Close menu when clicking a link
    const links = mobileNav.querySelectorAll('a');
    links.forEach((link) => {
      link.addEventListener('click', () => {
        mobileNav.classList.add('hidden');
        mobileMenuBtn.setAttribute('aria-expanded', 'false');
      });
    });
    
    // Cerrar menú con Escape
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && !mobileNav.classList.contains('hidden')) {
        mobileNav.classList.add('hidden');
        mobileMenuBtn.setAttribute('aria-expanded', 'false');
        mobileMenuBtn.focus();
      }
    });
  }

  // Language Switcher functionality
  function setLanguage(lang: string) {
    // Obtener idioma actual
    const currentLang = document.documentElement.dataset.lang || 'es';
    
    // Solo recargar si el idioma es diferente
    if (lang === currentLang) {
      console.log(`Ya estás en ${lang === 'es' ? 'Español' : 'English'}`);
      return;
    }
    
    // Guardar idioma en localStorage
    localStorage.setItem('preferredLanguage', lang);
    
    // Actualizar botones
    document.querySelectorAll('.lang-btn, .lang-btn-mobile').forEach(btn => {
      btn.classList.remove('bg-cyan-500', 'text-slate-950', 'border-slate-800');
      btn.classList.add('bg-slate-900/50', 'text-slate-400', 'border', 'border-slate-800');
      btn.setAttribute('aria-current', 'false');
    });

    // Marcar botón activo
    const activeButtons = document.querySelectorAll(`#lang-${lang}, #lang-${lang}-mobile`);
    activeButtons.forEach(btn => {
      btn.classList.remove('bg-slate-900/50', 'text-slate-400', 'border', 'border-slate-800');
      btn.classList.add('bg-cyan-500', 'text-slate-950');
      btn.setAttribute('aria-current', 'true');
    });

    // Actualizar el idioma en el HTML element
    document.documentElement.dataset.lang = lang;
    document.documentElement.lang = lang;

    // Mostrar notificación simple
    console.log(`Idioma cambiado a: ${lang === 'es' ? 'Español' : 'English'}`);

    // Disparar evento para actualizar contenido
    document.dispatchEvent(new CustomEvent('languageChanged', { detail: { language: lang } }));
  }

  // Función para inicializar sin recargar
  function initializeLanguage() {
    const savedLang = localStorage.getItem('preferredLanguage') || 'es';
    
    // Actualizar botones sin recargar
    document.querySelectorAll('.lang-btn, .lang-btn-mobile').forEach(btn => {
      btn.classList.remove('bg-cyan-500', 'text-slate-950', 'border-slate-800');
      btn.classList.add('bg-slate-900/50', 'text-slate-400', 'border', 'border-slate-800');
      btn.setAttribute('aria-current', 'false');
    });

    const activeButtons = document.querySelectorAll(`#lang-${savedLang}, #lang-${savedLang}-mobile`);
    activeButtons.forEach(btn => {
      btn.classList.remove('bg-slate-900/50', 'text-slate-400', 'border', 'border-slate-800');
      btn.classList.add('bg-cyan-500', 'text-slate-950');
      btn.setAttribute('aria-current', 'true');
    });

    // Actualizar el idioma en el HTML element
    document.documentElement.dataset.lang = savedLang;
    document.documentElement.lang = savedLang;

    // Disparar evento sin recargar
    document.dispatchEvent(new CustomEvent('languageChanged', { detail: { language: savedLang } }));
  }

  function updateNavTexts() {
    const lang = (document.documentElement.dataset.lang as keyof typeof i18n) || 'es';
    const texts = i18n[lang];
    
    // Desktop nav
    const navServicios = document.querySelector('.nav-servicios');
    const navProceso = document.querySelector('.nav-proceso');
    const navBeneficios = document.querySelector('.nav-beneficios');
    const navFaq = document.querySelector('.nav-faq');
    const navContacto = document.querySelector('.nav-contacto');
    
    if (navServicios) navServicios.textContent = texts.nav.servicios;
    if (navProceso) navProceso.textContent = texts.nav.proceso;
    if (navBeneficios) navBeneficios.textContent = texts.nav.beneficios;
    if (navFaq) navFaq.textContent = texts.nav.faq;
    if (navContacto) navContacto.textContent = texts.nav.contacto;
    
    // Mobile nav
    const navServiciosMobile = document.querySelector('.nav-servicios-mobile');
    const navProcesoMobile = document.querySelector('.nav-proceso-mobile');
    const navBeneficiosMobile = document.querySelector('.nav-beneficios-mobile');
    const navFaqMobile = document.querySelector('.nav-faq-mobile');
    const navContactoMobile = document.querySelector('.nav-contacto-mobile');
    
    if (navServiciosMobile) navServiciosMobile.textContent = texts.nav.servicios;
    if (navProcesoMobile) navProcesoMobile.textContent = texts.nav.proceso;
    if (navBeneficiosMobile) navBeneficiosMobile.textContent = texts.nav.beneficios;
    if (navFaqMobile) navFaqMobile.textContent = texts.nav.faq;
    if (navContactoMobile) navContactoMobile.textContent = texts.nav.contacto;
    
    // Language label mobile
    const langLabelMobile = document.querySelector('.lang-label-mobile');
    if (langLabelMobile) langLabelMobile.textContent = texts.footer.language;
  }
  
  document.addEventListener('languageChanged', updateNavTexts);

  // Botones desktop
  const langEsBtn = document.getElementById('lang-es');
  const langEnBtn = document.getElementById('lang-en');

  if (langEsBtn) langEsBtn.addEventListener('click', () => setLanguage('es'));
  if (langEnBtn) langEnBtn.addEventListener('click', () => setLanguage('en'));

  // Botones mobile
  const langEsMobileBtn = document.getElementById('lang-es-mobile');
  const langEnMobileBtn = document.getElementById('lang-en-mobile');

  if (langEsMobileBtn) langEsMobileBtn.addEventListener('click', () => setLanguage('es'));
  if (langEnMobileBtn) langEnMobileBtn.addEventListener('click', () => setLanguage('en'));

  // Inicializar idioma guardado al cargar sin recargar
  initializeLanguage();
  
  // Importar i18n después de todo
  import { i18n } from '../config/i18n';
  updateNavTexts();
</script>
